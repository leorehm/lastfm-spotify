var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function l(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function d(){return f(" ")}function p(){return f("")}function m(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t){return""===t?null:+t}function g(t,e){t.value=null==e?"":e}function y(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}t.selectedIndex=-1}function v(t,e,n){t.classList[n?"add":"remove"](e)}let $;function w(t){$=t}const x=[],k=[],_=[],C=[],P=Promise.resolve();let E=!1;function S(t){_.push(t)}const q=new Set;let A=0;function N(){const t=$;do{for(;A<x.length;){const t=x[A];A++,w(t),j(t.$$)}for(w(null),x.length=0,A=0;k.length;)k.pop()();for(let t=0;t<_.length;t+=1){const e=_[t];q.has(e)||(q.add(e),e())}_.length=0}while(x.length);for(;C.length;)C.pop()();E=!1,q.clear(),w(t)}function j(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const O=new Set;let T;function z(t,e){t&&t.i&&(O.delete(t),t.i(e))}function L(t,e,n,o){if(t&&t.o){if(O.has(t))return;O.add(t),T.c.push((()=>{O.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function B(t){t&&t.c()}function R(t,n,s,i){const{fragment:l,on_mount:c,on_destroy:a,after_update:u}=t.$$;l&&l.m(n,s),i||S((()=>{const n=c.map(e).filter(r);a?a.push(...n):o(n),t.$$.on_mount=[]})),u.forEach(S)}function G(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function M(t,e){-1===t.$$.dirty[0]&&(x.push(t),E||(E=!0,P.then(N)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(e,r,s,i,l,c,u,f=[-1]){const d=$;w(e);const p=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:r.target||d.$$.root};u&&u(p.root);let m=!1;if(p.ctx=s?s(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&l(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),m&&M(e,t)),n})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!i&&i(p.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);p.fragment&&p.fragment.l(t),t.forEach(a)}else p.fragment&&p.fragment.c();r.intro&&z(e.$$.fragment),R(e,r.target,r.anchor,r.customElement),N()}w(d)}class I{$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const U=[];function J(t,e){return{subscribe:H(t,e).subscribe}}function H(e,n=t){let o;const r=new Set;function i(t){if(s(e,t)&&(e=t,o)){const t=!U.length;for(const t of r)t[1](),U.push(t,e);if(t){for(let t=0;t<U.length;t+=2)U[t][0](U[t+1]);U.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(s,l=t){const c=[s,l];return r.add(c),1===r.size&&(o=n(i)||t),s(e),()=>{r.delete(c),0===r.size&&(o(),o=null)}}}}const F=J(null,(function(t){const e={},n=/([^&;=]+)=?([^&;]*)/g,o=window.location.hash.substring(1);let r;for(;r=n.exec(o);)e[r[1]]=decodeURIComponent(r[2]);t(e.access_token),window.history.pushState("object or string","Title","/")})),K=J(null,(function(t){t("https://leorehm.github.io/lastfm-spotify")})),Q=H(!1),V=H(null);function W(t,e,n){const o=t.slice();return o[6]=e[n],o}function X(e){let n,o,r,s=e[6]+"";return{c(){n=u("option"),o=f(s),n.__value=r=e[6],n.value=n.__value},m(t,e){c(t,n,e),l(n,o)},p:t,d(t){t&&a(n)}}}function Y(e){let n,r,s,i,p,v,$,w,x,k,_,C,P,E,q,A,N,j,O,T,z,L,B,R,G,M,D,I,U,J,H,F,K,Q,V=e[6],Y=[];for(let t=0;t<V.length;t+=1)Y[t]=X(W(e,V,t));return{c(){n=u("div"),r=u("form"),s=u("div"),i=u("label"),i.textContent="last.fm username",p=d(),v=u("input"),$=u("br"),w=d(),x=u("div"),k=u("label"),k.textContent="track limit",_=d(),C=u("input"),P=u("br"),E=d(),q=u("div"),A=u("label"),A.textContent="time period",N=d(),j=u("select");for(let t=0;t<Y.length;t+=1)Y[t].c();O=u("br"),T=d(),z=u("button"),L=f("Get Data"),R=d(),G=u("div"),M=u("label"),M.textContent="songs retrieved from last.fm",D=d(),I=u("textarea"),U=d(),J=u("button"),H=f("Next"),h(i,"class","form-label svelte-3aywy4"),h(i,"for","username"),h(v,"class","form-input svelte-3aywy4"),h(v,"name","username"),h(v,"type","text"),h(k,"class","form-label svelte-3aywy4"),h(k,"for","limit"),h(C,"class","form-input svelte-3aywy4"),h(C,"name","limit"),h(C,"type","number"),h(C,"min","1"),h(C,"max","100"),h(A,"class","form-label svelte-3aywy4"),h(A,"for","period"),h(j,"class","form-input svelte-3aywy4"),h(j,"name","period"),void 0===e[0]&&S((()=>e[9].call(j))),h(r,"class","item-form"),h(z,"class","pure-button-primary svelte-3aywy4"),h(z,"id","submit-button"),h(z,"disbaled",B=e[3]=""),h(M,"for","output"),h(M,"class","form-label svelte-3aywy4"),I.readOnly=!0,h(I,"id","song-output"),h(I,"name","song-output"),h(I,"rows","limit"),h(I,"cols","50"),h(I,"class","svelte-3aywy4"),h(G,"class","item-output"),h(J,"class","pure-button-primary svelte-3aywy4"),h(J,"id","next-button"),J.disabled=F=""==e[2],h(n,"class","container svelte-3aywy4")},m(t,o){c(t,n,o),l(n,r),l(r,s),l(s,i),l(s,p),l(s,v),g(v,e[3]),l(s,$),l(r,w),l(r,x),l(x,k),l(x,_),l(x,C),g(C,e[1]),l(x,P),l(r,E),l(r,q),l(q,A),l(q,N),l(q,j);for(let t=0;t<Y.length;t+=1)Y[t].m(j,null);var a;y(j,e[0]),l(q,O),l(n,T),l(n,z),l(z,L),l(n,R),l(n,G),l(G,M),l(G,D),l(G,I),g(I,e[2]),l(n,U),l(n,J),l(J,H),K||(Q=[m(v,"input",e[7]),m(C,"input",e[8]),m(j,"change",e[9]),m(r,"submit",(a=e[4],function(t){return t.preventDefault(),a.call(this,t)})),m(z,"click",e[4]),m(I,"input",e[10]),m(J,"click",e[5])],K=!0)},p(t,[e]){if(8&e&&v.value!==t[3]&&g(v,t[3]),2&e&&b(C.value)!==t[1]&&g(C,t[1]),64&e){let n;for(V=t[6],n=0;n<V.length;n+=1){const o=W(t,V,n);Y[n]?Y[n].p(o,e):(Y[n]=X(o),Y[n].c(),Y[n].m(j,null))}for(;n<Y.length;n+=1)Y[n].d(1);Y.length=V.length}65&e&&y(j,t[0]),8&e&&B!==(B=t[3]="")&&h(z,"disbaled",B),4&e&&g(I,t[2]),4&e&&F!==(F=""==t[2])&&(J.disabled=F)},i:t,o:t,d(t){t&&a(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(Y,t),K=!1,o(Q)}}}const Z="57411198178c595fbb09fabbe83934ac";function tt(t,e,n){let o,r;i(t,V,(t=>n(12,r=t)));const s=["overall","7day","1month","3month","6month","12month"];let l,c="7day",a=20,u="";return n(3,o=""),[c,a,u,o,async function(){console.log("username: ",o),l=await async function(){let t;console.log("fetching last.fm data...");const e="https://ws.audioscrobbler.com/2.0/?method=user.gettoptracks&user="+o+"&period="+c+"&limit="+a+"&api_key="+Z+"&format=json";return await fetch(e).then((t=>t.json())).then((e=>{t=e.toptracks.track,console.log("...done!")})),t}(),""!=u&&n(2,u="");for(let t=0;t<l.length;t++)n(2,u+=t+1+": "),n(2,u+=l[t].artist.name+" - "),n(2,u+=l[t].name+"\r\n");""==u&&n(2,u="It seems there are no songs available for the selected username and/or time period.")},function(){var t;r=l,t=r,V.set(t)},s,function(){o=this.value,n(3,o)},function(){a=b(this.value),n(1,a)},function(){c=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(0,c),n(6,s)},function(){u=this.value,n(2,u)}]}class et extends I{constructor(t){super(),D(this,t,tt,Y,s,{})}}function nt(t){let e,n,o,r,s,i,f,p,b,g,y,v;return{c(){e=u("div"),n=u("a"),o=u("button"),o.textContent="Connect to Spotify",r=d(),s=u("br"),i=d(),f=u("div"),p=u("label"),p.textContent="Remember me?",b=d(),g=u("input"),h(o,"class","pure-button pure-button-primary svelte-1inu2bh"),h(o,"id","login-btn"),h(n,"href",t[2]),h(p,"id","checkbox-label"),h(p,"for","remember-me"),h(p,"class","svelte-1inu2bh"),h(g,"id","checkbox-box"),h(g,"name","remember-me"),h(g,"type","checkbox"),h(g,"class","svelte-1inu2bh"),h(f,"id","checkbox-container"),h(f,"class","svelte-1inu2bh"),h(e,"id","login"),h(e,"class","svelte-1inu2bh")},m(a,u){c(a,e,u),l(e,n),l(n,o),l(e,r),l(e,s),l(e,i),l(e,f),l(f,p),l(f,b),l(f,g),g.checked=t[0],y||(v=m(g,"change",t[6]),y=!0)},p(t,e){4&e&&h(n,"href",t[2]),1&e&&(g.checked=t[0])},d(t){t&&a(e),y=!1,v()}}}function ot(t){let e,n,o,r,s;return{c(){e=u("section"),n=u("p"),n.textContent="Token expired! Please log out and log back in again.",o=d(),r=u("a"),s=u("button"),s.textContent="Logout",h(r,"href",t[1]),h(e,"class","expired-token")},m(t,i){c(t,e,i),l(e,n),l(e,o),l(e,r),l(r,s)},p(t,e){2&e&&h(r,"href",t[1])},d(t){t&&a(e)}}}function rt(e){let n,o,r=!e[3]&&nt(e),s=e[4]&&ot(e);return{c(){r&&r.c(),n=d(),s&&s.c(),o=p()},m(t,e){r&&r.m(t,e),c(t,n,e),s&&s.m(t,e),c(t,o,e)},p(t,[e]){t[3]?r&&(r.d(1),r=null):r?r.p(t,e):(r=nt(t),r.c(),r.m(n.parentNode,n)),t[4]?s?s.p(t,e):(s=ot(t),s.c(),s.m(o.parentNode,o)):s&&(s.d(1),s=null)},i:t,o:t,d(t){r&&r.d(t),t&&a(n),s&&s.d(t),t&&a(o)}}}function st(t,e,n){let o,r,s,l,c;i(t,K,(t=>n(1,s=t))),i(t,F,(t=>n(3,l=t))),i(t,Q,(t=>n(4,c=t)));const a=new URL("https://accounts.spotify.com/authorize?"),u=function(t){let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}(16);let f=!0;return t.$$.update=()=>{3&t.$$.dirty&&n(5,o=new URLSearchParams({response_type:"token",show_dialog:!f,client_id:"e27568bbeef44f7db83b446e2d6f57ab",scope:"user-read-private playlist-modify-public playlist-modify-private",redirect_uri:s,state:u})),32&t.$$.dirty&&n(2,r=a+o)},[f,s,r,l,c,o,function(){f=this.checked,n(0,f)}]}class it extends I{constructor(t){super(),D(this,t,st,rt,s,{})}}function lt(e){let n,r,s,i,p,b,y,$,w,x,k,_,C,P,E,S,q,A,N,j,O,T;return{c(){n=u("div"),r=u("label"),r.textContent="Playlist Name",s=d(),i=u("input"),p=u("br"),b=d(),y=u("label"),y.textContent="Description",$=d(),w=u("input"),x=u("br"),k=d(),_=u("div"),C=u("button"),C.textContent="Public",P=d(),E=u("button"),E.textContent="Private",S=d(),q=u("button"),q.innerHTML='Create Playlist <i class="fa-brands fa-spotify"></i>',A=d(),N=u("p"),j=f(e[3]),h(r,"class","label svelte-4q9i58"),h(r,"for","playlist-name"),h(i,"class","input svelte-4q9i58"),h(i,"name","playlist-name"),h(i,"type","text"),h(y,"class","label svelte-4q9i58"),h(y,"for","playlist-desc"),h(w,"class","input svelte-4q9i58"),h(w,"name","playlist-desc"),h(w,"type","text"),h(C,"id","public-button"),h(C,"class","toggle-button svelte-4q9i58"),v(C,"active",e[2]),h(E,"id","private-button"),h(E,"class","toggle-button svelte-4q9i58"),v(E,"active",!e[2]),h(_,"class","pure-button-group svelte-4q9i58"),h(_,"role","group"),h(q,"class","pure-button-primary svelte-4q9i58"),h(n,"class","container svelte-4q9i58")},m(t,o){c(t,n,o),l(n,r),l(n,s),l(n,i),g(i,e[0]),l(n,p),l(n,b),l(n,y),l(n,$),l(n,w),g(w,e[1]),l(n,x),l(n,k),l(n,_),l(_,C),l(_,P),l(_,E),l(n,S),l(n,q),l(n,A),l(n,N),l(N,j),O||(T=[m(i,"input",e[5]),m(w,"input",e[6]),m(C,"click",e[7]),m(E,"click",e[8]),m(q,"click",e[4],{once:!0})],O=!0)},p(t,[e]){1&e&&i.value!==t[0]&&g(i,t[0]),2&e&&w.value!==t[1]&&g(w,t[1]),4&e&&v(C,"active",t[2]),4&e&&v(E,"active",!t[2]),8&e&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(j,t[3])},i:t,o:t,d(t){t&&a(n),O=!1,o(T)}}}function ct(t,e,n){let o,r;i(t,F,(t=>n(11,o=t))),i(t,V,(t=>n(12,r=t)));let s,l,c="last.fm top "+r.length,a="",u=!0,f="";async function d(t,e){const n=`https://api.spotify.com/v1/search?q=track:${t}%20artist:${e}&type=track&limit=5`,r=o;let s;return await fetch(n,{method:"GET",headers:{Authorization:"Bearer "+r}}).then((t=>{if(t.ok)return t.json();throw new Error("Track not found - skipping")})).then((t=>{console.log("track_id found: ",t.tracks.items[0].uri),s=t.tracks.items[0].uri})).catch((t=>{console.log(t)})),s}return[c,a,u,f,async function(){await async function(){n(3,f="Please wait: getting user data...");const t=o;await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:"Bearer "+t}}).then((t=>t.json())).then((t=>{s=t.id}))}(),n(3,f="Please wait: Playlist is being created..."),console.log("creating playlist for user ",s);const t=o,e=await fetch(`https://api.spotify.com/v1/users/${s}/playlists`,{method:"POST",headers:{Authorization:"Bearer "+t},body:JSON.stringify({name:c,public:u,description:a,public:!1})});e.ok?l=await e.json():Q.set(!0),async function(){n(3,f="Please wait: Getting songs...");const t=[];for(let e=0;e<r.length;e++)t.push(await d(r[e].name,r[e].artist.name));n(3,f="Please wait: Adding songs to playlist...");const e=o,s=`https://api.spotify.com/v1/playlists/${l.id}/tracks`;await fetch(s,{method:"POST",headers:{Authorization:"Bearer "+e},body:JSON.stringify({uris:t})}).then((t=>{if(t.ok)return t.json();throw new Error("Adding to playlist not successful")})).then((t=>{console.log("add to playlist RESPONSE: ",t)})).catch((t=>{console.log(t),n(3,f="Oh no, something went wrong!")})),n(3,f="Success!")}()},function(){c=this.value,n(0,c)},function(){a=this.value,n(1,a)},()=>n(2,u=!u),()=>n(2,u=!u)]}class at extends I{constructor(t){super(),D(this,t,ct,lt,s,{})}}function ut(t){let e,n;return e=new at({}),{c(){B(e.$$.fragment)},m(t,o){R(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function ft(t){let e,n;return e=new et({}),{c(){B(e.$$.fragment)},m(t,o){R(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function dt(t){let e,n;return e=new it({}),{c(){B(e.$$.fragment)},m(t,o){R(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function pt(t){let e,n,r,s,i,l;const f=[dt,ft,ut],m=[];function h(t,e){return!t[0]||t[1]?0:t[2]?t[0]&&t[2]?2:-1:1}return~(r=h(t))&&(s=m[r]=f[r](t)),{c(){var t,o,r,l;e=u("h2"),e.textContent="last.fm to spotify playlist",n=d(),s&&s.c(),i=p(),t=e,o="text-align",null===(r="center")?t.style.removeProperty(o):t.style.setProperty(o,r,l?"important":"")},m(t,o){c(t,e,o),c(t,n,o),~r&&m[r].m(t,o),c(t,i,o),l=!0},p(t,[e]){let n=r;r=h(t),r!==n&&(s&&(T={r:0,c:[],p:T},L(m[n],1,1,(()=>{m[n]=null})),T.r||o(T.c),T=T.p),~r?(s=m[r],s||(s=m[r]=f[r](t),s.c()),z(s,1),s.m(i.parentNode,i)):s=null)},i(t){l||(z(s),l=!0)},o(t){L(s),l=!1},d(t){t&&a(e),t&&a(n),~r&&m[r].d(t),t&&a(i)}}}function mt(t,e,n){let o,r,s;return i(t,F,(t=>n(0,o=t))),i(t,Q,(t=>n(1,r=t))),i(t,V,(t=>n(2,s=t))),[o,r,s]}return new class extends I{constructor(t){super(),D(this,t,mt,pt,s,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map

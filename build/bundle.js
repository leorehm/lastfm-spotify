var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function s(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function d(){return f(" ")}function p(){return f("")}function m(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t){return""===t?null:+t}function g(t,e){t.value=null==e?"":e}function y(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}t.selectedIndex=-1}let $;function v(t){$=t}function x(t){(function(){if(!$)throw new Error("Function called outside component initialization");return $})().$$.on_mount.push(t)}const k=[],w=[],_=[],z=[],E=Promise.resolve();let C=!1;function S(t){_.push(t)}const P=new Set;let A=0;function N(){const t=$;do{for(;A<k.length;){const t=k[A];A++,v(t),j(t.$$)}for(v(null),k.length=0,A=0;w.length;)w.pop()();for(let t=0;t<_.length;t+=1){const e=_[t];P.has(e)||(P.add(e),e())}_.length=0}while(k.length);for(;z.length;)z.pop()();C=!1,P.clear(),v(t)}function j(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const O=new Set;let T;function B(t,e){t&&t.i&&(O.delete(t),t.i(e))}function L(t,e,n,o){if(t&&t.o){if(O.has(t))return;O.add(t),T.c.push((()=>{O.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function R(t){t&&t.c()}function G(t,n,i,c){const{fragment:s,on_mount:l,on_destroy:a,after_update:u}=t.$$;s&&s.m(n,i),c||S((()=>{const n=l.map(e).filter(r);a?a.push(...n):o(n),t.$$.on_mount=[]})),u.forEach(S)}function q(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function D(t,e){-1===t.$$.dirty[0]&&(k.push(t),C||(C=!0,E.then(N)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function M(e,r,i,c,s,l,u,f=[-1]){const d=$;v(e);const p=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:r.target||d.$$.root};u&&u(p.root);let m=!1;if(p.ctx=i?i(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&s(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),m&&D(e,t)),n})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!c&&c(p.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);p.fragment&&p.fragment.l(t),t.forEach(a)}else p.fragment&&p.fragment.c();r.intro&&B(e.$$.fragment),G(e,r.target,r.anchor,r.customElement),N()}v(d)}class U{$destroy(){q(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const I=[];function J(t,e){return{subscribe:F(t,e).subscribe}}function F(e,n=t){let o;const r=new Set;function c(t){if(i(e,t)&&(e=t,o)){const t=!I.length;for(const t of r)t[1](),I.push(t,e);if(t){for(let t=0;t<I.length;t+=2)I[t][0](I[t+1]);I.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(i,s=t){const l=[i,s];return r.add(l),1===r.size&&(o=n(c)||t),i(e),()=>{r.delete(l),0===r.size&&(o(),o=null)}}}}const H=J(null,(function(t){const e={},n=/([^&;=]+)=?([^&;]*)/g,o=window.location.hash.substring(1);let r;for(;r=n.exec(o);)e[r[1]]=decodeURIComponent(r[2]);t(e.access_token),window.history.pushState("object or string","Title","/")})),K=J(null,(function(t){t("https://leorehm.github.io/lastfm-spotify")})),Q=F("medium_term"),V=F(!1),W=F(null);function X(t,e,n){const o=t.slice();return o[6]=e[n],o}function Y(e){let n,o,r,i=e[6]+"";return{c(){n=u("option"),o=f(i),n.__value=r=e[6],n.value=n.__value},m(t,e){l(t,n,e),s(n,o)},p:t,d(t){t&&a(n)}}}function Z(e){let n,r,i,c,p,$,v,x,k,w,_,z,E,C,P,A,N,j,O,T,B,L,R,G,q,D,M,U,I,J,F,H,K=e[6],Q=[];for(let t=0;t<K.length;t+=1)Q[t]=Y(X(e,K,t));return{c(){n=u("div"),r=u("form"),i=u("div"),c=u("label"),c.textContent="last.fm username",p=d(),$=u("input"),v=u("br"),x=d(),k=u("div"),w=u("label"),w.textContent="track limit",_=d(),z=u("input"),E=u("br"),C=d(),P=u("div"),A=u("label"),A.textContent="time period",N=d(),j=u("select");for(let t=0;t<Q.length;t+=1)Q[t].c();O=u("br"),T=d(),B=u("button"),L=f("Get Data"),G=d(),q=u("div"),D=u("textarea"),M=d(),U=u("button"),I=f("Next"),h(c,"class","form-label svelte-et0bzl"),h(c,"for","username"),h($,"class","form-input svelte-et0bzl"),h($,"name","username"),h($,"type","text"),h(w,"class","form-label svelte-et0bzl"),h(w,"for","limit"),h(z,"class","form-input svelte-et0bzl"),h(z,"name","limit"),h(z,"type","number"),h(z,"min","1"),h(z,"max","100"),h(A,"class","form-label svelte-et0bzl"),h(A,"for","period"),h(j,"class","form-input svelte-et0bzl"),h(j,"name","period"),void 0===e[1]&&S((()=>e[9].call(j))),h(B,"id","submit-button"),h(B,"disbaled",R=e[0]=""),h(B,"class","svelte-et0bzl"),h(r,"class","item-form svelte-et0bzl"),D.readOnly=!0,h(D,"id","song-output"),h(D,"rows","limit"),h(D,"cols","50"),h(D,"class","svelte-et0bzl"),h(q,"class","item-output svelte-et0bzl"),h(n,"class","container svelte-et0bzl"),h(U,"id","next-button"),U.disabled=J=""==e[3],h(U,"class","svelte-et0bzl")},m(t,o){l(t,n,o),s(n,r),s(r,i),s(i,c),s(i,p),s(i,$),g($,e[0]),s(i,v),s(r,x),s(r,k),s(k,w),s(k,_),s(k,z),g(z,e[2]),s(k,E),s(r,C),s(r,P),s(P,A),s(P,N),s(P,j);for(let t=0;t<Q.length;t+=1)Q[t].m(j,null);var a;y(j,e[1]),s(P,O),s(r,T),s(r,B),s(B,L),s(n,G),s(n,q),s(q,D),g(D,e[3]),l(t,M,o),l(t,U,o),s(U,I),F||(H=[m($,"input",e[7]),m(z,"input",e[8]),m(j,"change",e[9]),m(B,"click",e[4],{once:!0}),m(r,"submit",(a=e[4],function(t){return t.preventDefault(),a.call(this,t)})),m(D,"input",e[10]),m(U,"click",e[5],{once:!0})],F=!0)},p(t,[e]){if(1&e&&$.value!==t[0]&&g($,t[0]),4&e&&b(z.value)!==t[2]&&g(z,t[2]),64&e){let n;for(K=t[6],n=0;n<K.length;n+=1){const o=X(t,K,n);Q[n]?Q[n].p(o,e):(Q[n]=Y(o),Q[n].c(),Q[n].m(j,null))}for(;n<Q.length;n+=1)Q[n].d(1);Q.length=K.length}66&e&&y(j,t[1]),1&e&&R!==(R=t[0]="")&&h(B,"disbaled",R),8&e&&g(D,t[3]),8&e&&J!==(J=""==t[3])&&(U.disabled=J)},i:t,o:t,d(t){t&&a(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(Q,t),t&&a(M),t&&a(U),F=!1,o(H)}}}const tt="57411198178c595fbb09fabbe83934ac";function et(t,e,n){let o;c(t,W,(t=>n(12,o=t)));let r="";const i=["overall","7day","1month","3month","6month","12month"];let s,l="7day",a=20,u="";return[r,l,a,u,async function(){await async function(){console.log("fetching last.fm data...");const t="https://ws.audioscrobbler.com/2.0/?method=user.gettoptracks&user="+r+"&period="+l+"&limit="+a+"&api_key="+tt+"&format=json";await fetch(t).then((t=>t.json())).then((t=>{s=t.toptracks.track,console.log("...done!")}))}(),""!=u&&n(3,u="");for(let t=0;t<s.length;t++)n(3,u+=t+1+": "),n(3,u+=s[t].artist.name+" - "),n(3,u+=s[t].name+"\r\n")},function(){var t;o=s,t=o,W.set(t)},i,function(){r=this.value,n(0,r)},function(){a=b(this.value),n(2,a)},function(){l=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(1,l),n(6,i)},function(){u=this.value,n(3,u)}]}class nt extends U{constructor(t){super(),M(this,t,et,Z,i,{})}}function ot(t){let e,n,o,r,i,c,f,p,b,g,y,$;return{c(){e=u("div"),n=u("a"),o=u("button"),o.textContent="Connect to Spotify",r=d(),i=u("br"),c=d(),f=u("div"),p=u("label"),p.textContent="Remember me?",b=d(),g=u("input"),h(o,"class","login-btn"),h(n,"href",t[2]),h(p,"id","checkbox-text"),h(p,"for","remember-me"),h(g,"id","checkbox-box"),h(g,"name","remember-me"),h(g,"type","checkbox"),h(f,"id","checkbox-container"),h(e,"id","login")},m(a,u){l(a,e,u),s(e,n),s(n,o),s(e,r),s(e,i),s(e,c),s(e,f),s(f,p),s(f,b),s(f,g),g.checked=t[0],y||($=m(g,"change",t[6]),y=!0)},p(t,e){4&e&&h(n,"href",t[2]),1&e&&(g.checked=t[0])},d(t){t&&a(e),y=!1,$()}}}function rt(t){let e,n,o,r,i;return{c(){e=u("section"),n=u("p"),n.textContent="Token expired! Please log out and log back in again.",o=d(),r=u("a"),i=u("button"),i.textContent="Logout",h(r,"href",t[1]),h(e,"class","expired-token")},m(t,c){l(t,e,c),s(e,n),s(e,o),s(e,r),s(r,i)},p(t,e){2&e&&h(r,"href",t[1])},d(t){t&&a(e)}}}function it(e){let n,o,r=!e[3]&&ot(e),i=e[4]&&rt(e);return{c(){r&&r.c(),n=d(),i&&i.c(),o=p()},m(t,e){r&&r.m(t,e),l(t,n,e),i&&i.m(t,e),l(t,o,e)},p(t,[e]){t[3]?r&&(r.d(1),r=null):r?r.p(t,e):(r=ot(t),r.c(),r.m(n.parentNode,n)),t[4]?i?i.p(t,e):(i=rt(t),i.c(),i.m(o.parentNode,o)):i&&(i.d(1),i=null)},i:t,o:t,d(t){r&&r.d(t),t&&a(n),i&&i.d(t),t&&a(o)}}}function ct(t,e,n){let o,r,i,s,l;c(t,K,(t=>n(1,i=t))),c(t,H,(t=>n(3,s=t))),c(t,V,(t=>n(4,l=t)));const a=new URL("https://accounts.spotify.com/authorize?"),u=function(t){let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}(16);let f=!0;return t.$$.update=()=>{3&t.$$.dirty&&n(5,o=new URLSearchParams({response_type:"token",show_dialog:!f,client_id:"e27568bbeef44f7db83b446e2d6f57ab",scope:"user-read-private user-read-email playlist-modify-public playlist-modify-private playlist-read-private",redirect_uri:i,state:u})),32&t.$$.dirty&&n(2,r=a+o)},[f,i,r,s,l,o,function(){f=this.checked,n(0,f)}]}class st extends U{constructor(t){super(),M(this,t,ct,it,i,{})}}function lt(e){let n,r,i,c,p,b,y,$,v,x,k,w,_,z,E,C;return{c(){n=u("label"),n.textContent="Playlist Name",r=d(),i=u("input"),c=u("br"),p=d(),b=u("label"),b.textContent="Description",y=d(),$=u("input"),v=u("br"),x=d(),k=u("button"),k.textContent="Playlist erstellen",w=d(),_=u("p"),z=f(e[2]),h(n,"class","label"),h(n,"for","playlist-name"),h(i,"class","input"),h(i,"name","playlist-name"),h(i,"type","text"),h(b,"class","label"),h(b,"for","playlist-desc"),h($,"class","input"),h($,"name","playlist-desc"),h($,"type","text")},m(t,o){l(t,n,o),l(t,r,o),l(t,i,o),g(i,e[0]),l(t,c,o),l(t,p,o),l(t,b,o),l(t,y,o),l(t,$,o),g($,e[1]),l(t,v,o),l(t,x,o),l(t,k,o),l(t,w,o),l(t,_,o),s(_,z),E||(C=[m(i,"input",e[4]),m($,"input",e[5]),m(k,"click",e[3],{once:!0})],E=!0)},p(t,[e]){1&e&&i.value!==t[0]&&g(i,t[0]),2&e&&$.value!==t[1]&&g($,t[1]),4&e&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(z,t[2])},i:t,o:t,d(t){t&&a(n),t&&a(r),t&&a(i),t&&a(c),t&&a(p),t&&a(b),t&&a(y),t&&a($),t&&a(v),t&&a(x),t&&a(k),t&&a(w),t&&a(_),E=!1,o(C)}}}function at(t,e,n){let o,r,i,s;c(t,H,(t=>n(8,o=t))),c(t,W,(t=>n(9,r=t))),c(t,V,(t=>n(10,i=t))),c(t,Q,(t=>n(11,s=t)));let l,a,u="last.fm top "+r.length+1,f="",d="";async function p(t,e){const n=`https://api.spotify.com/v1/search?q=track:${t}%20artist:${e}&type=track&limit=5`,r=o;let i;return await fetch(n,{method:"GET",headers:{Authorization:"Bearer "+r}}).then((t=>{if(t.ok)return t.json();throw new Error("Track not found - skipping")})).then((t=>{console.log(t),console.log("track_id found: ",t.tracks.items[0].uri),i=t.tracks.items[0].uri})).catch((t=>{console.log(t)})),i}return x((()=>{console.log("token: ",o),console.log("time range: ",s),console.log("token expired: ",i),console.log("track data: ",r)})),[u,f,d,async function(){n(2,d="Please wait: Playlist is being created..."),await async function(){const t=o;await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:"Bearer "+t}}).then((t=>t.json())).then((t=>{l=t.id}))}(),console.log("creating playlist for user ",l);const t=o,e=await fetch(`https://api.spotify.com/v1/users/${l}/playlists`,{method:"POST",headers:{Authorization:"Bearer "+t},body:JSON.stringify({name:u,description:f,public:!1})});e.ok?a=await e.json():V.set(!0),async function(){n(2,d="Please wait: Getting songs...");const t=[];for(let e=0;e<r.length;e++)t.push(await p(r[e].name,r[e].artist.name));n(2,d="Please wait: Adding songs to playlist...");const e=o,i=`https://api.spotify.com/v1/playlists/${a.id}/tracks`;await fetch(i,{method:"POST",headers:{Authorization:"Bearer "+e},body:JSON.stringify({uris:t})}).then((t=>{if(t.ok)return t.json();throw new Error("Adding to playlist not successful")})).then((t=>{console.log("add to playlist RESPONSE: ",t)})).catch((t=>{console.log(t)})),n(2,d="Success!")}()},function(){u=this.value,n(0,u)},function(){f=this.value,n(1,f)}]}class ut extends U{constructor(t){super(),M(this,t,at,lt,i,{})}}function ft(t){let e,n;return e=new ut({}),{c(){R(e.$$.fragment)},m(t,o){G(e,t,o),n=!0},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function dt(t){let e,n;return e=new nt({}),{c(){R(e.$$.fragment)},m(t,o){G(e,t,o),n=!0},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function pt(t){let e,n;return e=new st({}),{c(){R(e.$$.fragment)},m(t,o){G(e,t,o),n=!0},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function mt(t){let e,n,r,i;const c=[pt,dt,ft],s=[];function u(t,e){return!t[0]||t[1]?0:t[2]?t[0]&&t[2]?2:-1:1}return~(e=u(t))&&(n=s[e]=c[e](t)),{c(){n&&n.c(),r=p()},m(t,n){~e&&s[e].m(t,n),l(t,r,n),i=!0},p(t,[i]){let l=e;e=u(t),e!==l&&(n&&(T={r:0,c:[],p:T},L(s[l],1,1,(()=>{s[l]=null})),T.r||o(T.c),T=T.p),~e?(n=s[e],n||(n=s[e]=c[e](t),n.c()),B(n,1),n.m(r.parentNode,r)):n=null)},i(t){i||(B(n),i=!0)},o(t){L(n),i=!1},d(t){~e&&s[e].d(t),t&&a(r)}}}function ht(t,e,n){let o,r,i;return c(t,H,(t=>n(0,o=t))),c(t,V,(t=>n(1,r=t))),c(t,W,(t=>n(2,i=t))),[o,r,i]}return new class extends U{constructor(t){super(),M(this,t,ht,mt,i,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map

var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function s(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function i(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function c(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function d(){return f(" ")}function p(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function m(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function h(t){return""===t?null:+t}function b(t,e){t.value=null==e?"":e}function y(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}t.selectedIndex=-1}function g(t,e,n){t.classList[n?"add":"remove"](e)}let v;function $(t){v=t}const k=[],w=[],x=[],_=[],P=Promise.resolve();let C=!1;function S(t){x.push(t)}const E=new Set;let T=0;function z(){const t=v;do{for(;T<k.length;){const t=k[T];T++,$(t),A(t.$$)}for($(null),k.length=0,T=0;w.length;)w.pop()();for(let t=0;t<x.length;t+=1){const e=x[t];E.has(e)||(E.add(e),e())}x.length=0}while(k.length);for(;_.length;)_.pop()();C=!1,E.clear(),$(t)}function A(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const L=new Set;let N;function O(t,e){t&&t.i&&(L.delete(t),t.i(e))}function j(t,e,n,o){if(t&&t.o){if(L.has(t))return;L.add(t),N.c.push((()=>{L.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function M(t){t&&t.c()}function B(t,n,r,l){const{fragment:i,on_mount:a,on_destroy:c,after_update:u}=t.$$;i&&i.m(n,r),l||S((()=>{const n=a.map(e).filter(s);c?c.push(...n):o(n),t.$$.on_mount=[]})),u.forEach(S)}function R(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function U(t,e){-1===t.$$.dirty[0]&&(k.push(t),C||(C=!0,P.then(z)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function G(e,s,r,l,i,a,u,f=[-1]){const d=v;$(e);const p=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:i,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(s.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:s.target||d.$$.root};u&&u(p.root);let m=!1;if(p.ctx=r?r(e,s.props||{},((t,n,...o)=>{const s=o.length?o[0]:n;return p.ctx&&i(p.ctx[t],p.ctx[t]=s)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](s),m&&U(e,t)),n})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!l&&l(p.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);p.fragment&&p.fragment.l(t),t.forEach(c)}else p.fragment&&p.fragment.c();s.intro&&O(e.$$.fragment),B(e,s.target,s.anchor,s.customElement),z()}$(d)}class q{$destroy(){R(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const D=[];function H(t,e){return{subscribe:I(t,e).subscribe}}function I(e,n=t){let o;const s=new Set;function l(t){if(r(e,t)&&(e=t,o)){const t=!D.length;for(const t of s)t[1](),D.push(t,e);if(t){for(let t=0;t<D.length;t+=2)D[t][0](D[t+1]);D.length=0}}}return{set:l,update:function(t){l(t(e))},subscribe:function(r,i=t){const a=[r,i];return s.add(a),1===s.size&&(o=n(l)||t),r(e),()=>{s.delete(a),0===s.size&&(o(),o=null)}}}}const J=H(null,(function(t){const e={},n=/([^&;=]+)=?([^&;]*)/g,o=window.location.hash.substring(1);let s;for(;s=n.exec(o);)e[s[1]]=decodeURIComponent(s[2]);t(e.access_token),window.history.pushState("object or string","Title","/")})),V=H(null,(function(t){t("https://leorehm.github.io/lastfm-spotify")})),F=I(!1),K=I(null);function Q(t,e,n){const o=t.slice();return o[7]=e[n],o}function W(e){let n,o,s,r=e[7]+"";return{c(){n=u("option"),o=f(r),n.__value=s=e[7],n.value=n.__value},m(t,e){a(t,n,e),i(n,o)},p:t,d(t){t&&c(n)}}}function X(e){let n,s,r,l,g,v,$,k,w,x,_,P,C,E,T,z,A,L,N,O,j,M,B,R,U,G,q,D,H,I,J,V,F,K,X=e[7],Y=[];for(let t=0;t<X.length;t+=1)Y[t]=W(Q(e,X,t));return{c(){n=u("div"),s=u("form"),r=u("div"),l=u("label"),l.textContent="last.fm Username",g=d(),v=u("input"),$=u("br"),k=d(),w=u("div"),x=u("label"),x.textContent="Track Limit",_=d(),P=u("input"),C=u("br"),E=d(),T=u("div"),z=u("label"),z.textContent="Time Period",A=d(),L=u("select");for(let t=0;t<Y.length;t+=1)Y[t].c();N=u("br"),O=d(),j=u("button"),M=f("Get Data "),B=u("i"),U=d(),G=u("div"),q=u("label"),q.textContent="Songs retrieved from last.fm",D=d(),H=u("textarea"),I=d(),J=u("button"),V=f("Next"),m(l,"class","form-label svelte-3aywy4"),m(l,"for","username"),m(v,"class","form-input svelte-3aywy4"),m(v,"name","username"),m(v,"type","text"),m(x,"class","form-label svelte-3aywy4"),m(x,"for","limit"),m(P,"class","form-input svelte-3aywy4"),m(P,"name","limit"),m(P,"type","number"),m(P,"min","1"),m(P,"max","100"),m(z,"class","form-label svelte-3aywy4"),m(z,"for","period"),m(L,"class","form-input svelte-3aywy4"),m(L,"name","period"),void 0===e[0]&&S((()=>e[10].call(L))),m(s,"class","item-form"),m(B,"class","fa-brands fa-lastfm"),m(j,"class","pure-button-primary svelte-3aywy4"),m(j,"id","submit-button"),m(j,"disbaled",R=e[4]=""),m(q,"for","output"),m(q,"class","form-label svelte-3aywy4"),H.readOnly=!0,m(H,"id","song-output"),m(H,"name","song-output"),m(H,"rows","limit"),m(H,"cols","50"),m(H,"class","svelte-3aywy4"),m(G,"class","item-output"),m(J,"class","pure-button-primary svelte-3aywy4"),m(J,"id","next-button"),J.disabled=e[3],m(n,"class","container svelte-3aywy4")},m(t,o){a(t,n,o),i(n,s),i(s,r),i(r,l),i(r,g),i(r,v),b(v,e[4]),i(r,$),i(s,k),i(s,w),i(w,x),i(w,_),i(w,P),b(P,e[1]),i(w,C),i(s,E),i(s,T),i(T,z),i(T,A),i(T,L);for(let t=0;t<Y.length;t+=1)Y[t].m(L,null);var c;y(L,e[0]),i(T,N),i(n,O),i(n,j),i(j,M),i(j,B),i(n,U),i(n,G),i(G,q),i(G,D),i(G,H),b(H,e[2]),i(n,I),i(n,J),i(J,V),F||(K=[p(v,"input",e[8]),p(P,"input",e[9]),p(L,"change",e[10]),p(s,"submit",(c=e[5],function(t){return t.preventDefault(),c.call(this,t)})),p(j,"click",e[5]),p(H,"input",e[11]),p(J,"click",e[6])],F=!0)},p(t,[e]){if(16&e&&v.value!==t[4]&&b(v,t[4]),2&e&&h(P.value)!==t[1]&&b(P,t[1]),128&e){let n;for(X=t[7],n=0;n<X.length;n+=1){const o=Q(t,X,n);Y[n]?Y[n].p(o,e):(Y[n]=W(o),Y[n].c(),Y[n].m(L,null))}for(;n<Y.length;n+=1)Y[n].d(1);Y.length=X.length}129&e&&y(L,t[0]),16&e&&R!==(R=t[4]="")&&m(j,"disbaled",R),4&e&&b(H,t[2]),8&e&&(J.disabled=t[3])},i:t,o:t,d(t){t&&c(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(Y,t),F=!1,o(K)}}}const Y="57411198178c595fbb09fabbe83934ac";function Z(t,e,n){let o,s;l(t,K,(t=>n(13,s=t)));const r=["overall","7day","1month","3month","6month","12month"];let i,a="7day",c=20,u="",f=!0;return n(4,o=""),[a,c,u,f,o,async function(){console.log("username: ",o);try{i=await async function(){let t;console.log("fetching last.fm data...");const e="https://ws.audioscrobbler.com/2.0/?method=user.gettoptracks&user="+o+"&period="+a+"&limit="+c+"&api_key="+Y+"&format=json";return await fetch(e).then((t=>{if(t.ok)return t.json();throw new Error("No songs found. User may not exist or have songs scrobbled during the selected timeframe.")})).then((e=>{t=e.toptracks.track,console.log("...done!")})).catch((e=>{console.log(e),t=e})),t}()}catch(t){return void n(2,u=K.toString())}""!=u&&n(2,u="");for(let t=0;t<i.length;t++)n(2,u+=t+1+": "),n(2,u+=i[t].artist.name+" - "),n(2,u+=i[t].name+"\r\n");if(""==u)return n(2,u="It seems there are no songs available for the selected username and/or time period."),void n(3,f=!0);n(3,f=!1)},function(){var t;s=i,t=s,K.set(t)},r,function(){o=this.value,n(4,o)},function(){c=h(this.value),n(1,c)},function(){a=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(0,a),n(7,r)},function(){u=this.value,n(2,u)}]}class tt extends q{constructor(t){super(),G(this,t,Z,X,r,{})}}function et(t){let e,n,o,s,r,l,f,h,b,y,g,v;return{c(){e=u("div"),n=u("a"),o=u("button"),o.textContent="Connect to Spotify",s=d(),r=u("br"),l=d(),f=u("div"),h=u("label"),h.textContent="Remember me?",b=d(),y=u("input"),m(o,"class","pure-button pure-button-primary svelte-1inu2bh"),m(o,"id","login-btn"),m(n,"href",t[2]),m(h,"id","checkbox-label"),m(h,"for","remember-me"),m(h,"class","svelte-1inu2bh"),m(y,"id","checkbox-box"),m(y,"name","remember-me"),m(y,"type","checkbox"),m(y,"class","svelte-1inu2bh"),m(f,"id","checkbox-container"),m(f,"class","svelte-1inu2bh"),m(e,"id","login"),m(e,"class","svelte-1inu2bh")},m(c,u){a(c,e,u),i(e,n),i(n,o),i(e,s),i(e,r),i(e,l),i(e,f),i(f,h),i(f,b),i(f,y),y.checked=t[0],g||(v=p(y,"change",t[6]),g=!0)},p(t,e){4&e&&m(n,"href",t[2]),1&e&&(y.checked=t[0])},d(t){t&&c(e),g=!1,v()}}}function nt(t){let e,n,o,s,r;return{c(){e=u("section"),n=u("p"),n.textContent="Token expired! Please log out and log back in again.",o=d(),s=u("a"),r=u("button"),r.textContent="Logout",m(s,"href",t[1]),m(e,"class","expired-token")},m(t,l){a(t,e,l),i(e,n),i(e,o),i(e,s),i(s,r)},p(t,e){2&e&&m(s,"href",t[1])},d(t){t&&c(e)}}}function ot(e){let n,o,s=!e[3]&&et(e),r=e[4]&&nt(e);return{c(){s&&s.c(),n=d(),r&&r.c(),o=f("")},m(t,e){s&&s.m(t,e),a(t,n,e),r&&r.m(t,e),a(t,o,e)},p(t,[e]){t[3]?s&&(s.d(1),s=null):s?s.p(t,e):(s=et(t),s.c(),s.m(n.parentNode,n)),t[4]?r?r.p(t,e):(r=nt(t),r.c(),r.m(o.parentNode,o)):r&&(r.d(1),r=null)},i:t,o:t,d(t){s&&s.d(t),t&&c(n),r&&r.d(t),t&&c(o)}}}function st(t,e,n){let o,s,r,i,a;l(t,V,(t=>n(1,r=t))),l(t,J,(t=>n(3,i=t))),l(t,F,(t=>n(4,a=t)));const c=new URL("https://accounts.spotify.com/authorize?"),u=function(t){let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}(16);let f=!0;return t.$$.update=()=>{3&t.$$.dirty&&n(5,o=new URLSearchParams({response_type:"token",show_dialog:!f,client_id:"e27568bbeef44f7db83b446e2d6f57ab",scope:"user-read-private playlist-modify-public playlist-modify-private",redirect_uri:r,state:u})),32&t.$$.dirty&&n(2,s=c+o)},[f,r,s,i,a,o,function(){f=this.checked,n(0,f)}]}class rt extends q{constructor(t){super(),G(this,t,st,ot,r,{})}}function lt(t){let e,n,o,s,r,l,h,y,g,v,$,k;return{c(){e=u("div"),n=u("label"),n.textContent="Playlist Link",o=d(),s=u("input"),r=u("br"),l=d(),h=u("a"),y=u("button"),g=f("Open Playlist "),v=u("i"),m(n,"for","playlist-link"),m(n,"class","label svelte-cudkfm"),m(s,"name","playlist-link"),m(s,"type","text"),m(s,"class","input svelte-cudkfm"),m(v,"class","fa-brands fa-spotify"),m(y,"class","pure-button-primary svelte-cudkfm"),m(y,"href",t[3]),m(h,"href",t[3]),m(e,"class","playlist-link")},m(c,u){a(c,e,u),i(e,n),i(e,o),i(e,s),b(s,t[3]),i(e,r),i(e,l),i(e,h),i(h,y),i(y,g),i(y,v),$||(k=p(s,"input",t[10]),$=!0)},p(t,e){8&e&&s.value!==t[3]&&b(s,t[3]),8&e&&m(y,"href",t[3]),8&e&&m(h,"href",t[3])},d(t){t&&c(e),$=!1,k()}}}function it(e){let n,s,r,l,h,y,v,$,k,w,x,_,P,C,S,E,T,z,A,L,N,O,j,M,B,R=""!=e[3]&&lt(e);return{c(){var t,o,i,a;n=u("div"),s=u("label"),s.textContent="Playlist Name",r=d(),l=u("input"),h=u("br"),y=d(),v=u("label"),v.textContent="Description",$=d(),k=u("input"),w=u("br"),x=d(),_=u("label"),_.textContent="Visibility",P=d(),C=u("div"),S=u("button"),S.textContent="Public",E=d(),T=u("button"),T.textContent="Private",z=d(),A=u("button"),A.innerHTML='Create Playlist <i class="fa-brands fa-spotify"></i>',L=d(),N=u("p"),O=f(e[4]),j=d(),R&&R.c(),m(s,"class","label svelte-cudkfm"),m(s,"for","playlist-name"),m(l,"class","input svelte-cudkfm"),m(l,"name","playlist-name"),m(l,"type","text"),m(v,"class","label svelte-cudkfm"),m(v,"for","playlist-desc"),m(k,"class","input svelte-cudkfm"),m(k,"name","playlist-desc"),m(k,"type","text"),m(_,"for","playlist-scope"),m(_,"class","label svelte-cudkfm"),m(S,"id","public-button"),m(S,"class","toggle-button svelte-cudkfm"),g(S,"active",e[2]),m(T,"id","private-button"),m(T,"class","toggle-button svelte-cudkfm"),g(T,"active",!e[2]),m(C,"name","playlist-scope"),m(C,"class","pure-button-group svelte-cudkfm"),m(C,"role","group"),m(A,"class","pure-button-primary svelte-cudkfm"),t=N,o="margin",null===(i="10px 0 10px 0")?t.style.removeProperty(o):t.style.setProperty(o,i,a?"important":""),m(n,"class","container svelte-cudkfm")},m(t,o){a(t,n,o),i(n,s),i(n,r),i(n,l),b(l,e[0]),i(n,h),i(n,y),i(n,v),i(n,$),i(n,k),b(k,e[1]),i(n,w),i(n,x),i(n,_),i(n,P),i(n,C),i(C,S),i(C,E),i(C,T),i(n,z),i(n,A),i(n,L),i(n,N),i(N,O),i(n,j),R&&R.m(n,null),M||(B=[p(l,"input",e[6]),p(k,"input",e[7]),p(S,"click",e[8]),p(T,"click",e[9]),p(A,"click",e[5],{once:!0})],M=!0)},p(t,[e]){1&e&&l.value!==t[0]&&b(l,t[0]),2&e&&k.value!==t[1]&&b(k,t[1]),4&e&&g(S,"active",t[2]),4&e&&g(T,"active",!t[2]),16&e&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(O,t[4]),""!=t[3]?R?R.p(t,e):(R=lt(t),R.c(),R.m(n,null)):R&&(R.d(1),R=null)},i:t,o:t,d(t){t&&c(n),R&&R.d(),M=!1,o(B)}}}const at=100;function ct(t,e,n){let o,s;l(t,J,(t=>n(13,o=t))),l(t,K,(t=>n(14,s=t)));let r,i,a="last.fm top "+s.length,c="",u=!0,f="",d="";async function p(t,e){const n=`https://api.spotify.com/v1/search?q=track:${t}%20artist:${e}&type=track&limit=5`,s=o;let r;return await fetch(n,{method:"GET",headers:{Authorization:"Bearer "+s}}).then((e=>{if(e.ok)return e.json();throw new Error("Track '"+t+"' not found - skipping")})).then((e=>{if(0==e.tracks.items.length)throw new Error("Track '"+t+"'' not found - skipping");console.log("track_id found: ",e.tracks.items[0].uri),r=e.tracks.items[0].uri})).catch((t=>{console.log(t),r=null})),r}return[a,c,u,f,d,async function(){await async function(){n(4,d="Please wait: getting user data...");const t=o;await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:"Bearer "+t}}).then((t=>t.json())).then((t=>{r=t.id}))}(),n(4,d="Please wait: Playlist is being created..."),console.log("creating playlist for user ",r);const t=o,e=await fetch(`https://api.spotify.com/v1/users/${r}/playlists`,{method:"POST",headers:{Authorization:"Bearer "+t},body:JSON.stringify({name:a,public:u,description:c,public:!1})});e.ok?i=await e.json():F.set(!0),async function(){n(4,d="Please wait: Getting songs...");const t=Math.floor(s.length/at),e=new Array(Math.floor(t));for(let n=0;n<=t;n++)e[n]=[];for(let t=0;t<s.length;t++){let n=Math.floor(t/at),o=await p(s[t].name,s[t].artist.name);null!=o&&e[n].push(o)}n(4,d="Please wait: Adding songs to playlist...");const r=o,l=`https://api.spotify.com/v1/playlists/${i.id}/tracks`;for(let t=0;t<e.length;t++)await fetch(l,{method:"POST",headers:{Authorization:"Bearer "+r},body:JSON.stringify({uris:e[t]})}).then((t=>{if(t.ok)return t.json();throw new Error("Adding to playlist not successful")})).then((t=>{console.log("add to playlist RESPONSE: ",t)})).catch((t=>{console.log(t),n(4,d="Oh no, something went wrong!")}));n(3,f=i.external_urls.spotify),n(4,d="Success!")}()},function(){a=this.value,n(0,a)},function(){c=this.value,n(1,c)},()=>n(2,u=!u),()=>n(2,u=!u),function(){f=this.value,n(3,f)}]}class ut extends q{constructor(t){super(),G(this,t,ct,it,r,{})}}function ft(t){let e,n;return e=new ut({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},i(t){n||(O(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function dt(t){let e,n;return e=new tt({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},i(t){n||(O(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function pt(t){let e,n;return e=new rt({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},i(t){n||(O(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function mt(t){let e,n,s,r,l,f,p,h,b;const y=[pt,dt,ft],g=[];function v(t,e){return!t[0]||t[1]?0:t[2]?t[0]&&t[2]?2:-1:1}return~(l=v(t))&&(f=g[l]=y[l](t)),{c(){e=u("div"),n=u("div"),n.innerHTML='<h2 style="text-align: center" class="svelte-1mze3wx">last.fm to spotify playlist</h2>',s=d(),r=u("main"),f&&f.c(),p=d(),h=u("footer"),h.innerHTML='<a href="https://github.com/leorehm/lastfm-spotify" target="_blank" class="svelte-1mze3wx"><i class="fa-brands fa-github"></i> Source</a>',m(n,"id","head"),m(r,"id","main"),m(r,"class","svelte-1mze3wx"),m(h,"id","footer"),m(h,"class","svelte-1mze3wx"),m(e,"id","app"),m(e,"class","svelte-1mze3wx")},m(t,o){a(t,e,o),i(e,n),i(e,s),i(e,r),~l&&g[l].m(r,null),i(e,p),i(e,h),b=!0},p(t,[e]){let n=l;l=v(t),l!==n&&(f&&(N={r:0,c:[],p:N},j(g[n],1,1,(()=>{g[n]=null})),N.r||o(N.c),N=N.p),~l?(f=g[l],f||(f=g[l]=y[l](t),f.c()),O(f,1),f.m(r,null)):f=null)},i(t){b||(O(f),b=!0)},o(t){j(f),b=!1},d(t){t&&c(e),~l&&g[l].d()}}}function ht(t,e,n){let o,s,r;return l(t,J,(t=>n(0,o=t))),l(t,F,(t=>n(1,s=t))),l(t,K,(t=>n(2,r=t))),[o,s,r]}return new class extends q{constructor(t){super(),G(this,t,ht,mt,r,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
